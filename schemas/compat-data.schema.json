{
  "$schema": "http://json-schema.org/draft-07/schema#",

  "definitions": {
    "internal_simple_support_statement": {
      "type": "object",
      "properties": {
        "version_added": {
          "description": "Browser version that added this feature, or false if not supported.",
          "anyOf": [
            {
              "type": "string",
              "pattern": "^(≤?(\\d+)(\\.\\d+)*|preview)$"
            },
            {
              "const": false
            }
          ],
          "tsType": "VersionValue"
        },
        "version_removed": {
          "description": "Browser version that removed this feature.",
          "type": "string",
          "pattern": "^(≤?(\\d+)(\\.\\d+)*|preview)$",
          "tsType": "string"
        },
        "prefix": {
          "type": "string",
          "description": "Prefix for the sub-feature name. Leading and trailing '-' must be included if applicable."
        },
        "alternative_name": {
          "type": "string",
          "description": "Alternative name for the feature, when implemented under an entirely different name."
        },
        "flags": {
          "type": "array",
          "description": "Flags that must be configured for this browser to support this feature.",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/flag_statement"
          },
          "tsType": "[FlagStatement, ...FlagStatement[]]"
        },
        "impl_url": {
          "anyOf": [
            {
              "$ref": "#/definitions/impl_url_value"
            },
            {
              "type": "array",
              "minItems": 2,
              "items": {
                "$ref": "#/definitions/impl_url_value"
              }
            }
          ],
          "description": "URL for the changeset/commit or bug that tracks the implementation of this feature.",
          "tsType": "string | [string, string, ...string[]]",
          "errorMessage": {
            "pattern": "impl_url must be a link to a browser commit or bug URL. URLs must be in shortened form (ex. bugs.chromium.org -> crbug.com). Note: `npm run fix` may resolve these issues."
          }
        },
        "partial_implementation": {
          "const": true,
          "description": "Whether the implementation deviates from the specification in a way that may cause compatibility problems. If true, a note explaining the divergence is required."
        },
        "notes": {
          "description": "Additional information about the feature's support.",
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "array",
              "minItems": 2,
              "items": {
                "type": "string"
              }
            }
          ],
          "tsType": "string | [string, string, ...string[]]"
        }
      },
      "required": ["version_added"],
      "dependencies": {
        "partial_implementation": {
          "if": {
            "properties": { "partial_implementation": { "const": true } }
          },
          "then": { "required": ["notes"] }
        }
      },
      "additionalProperties": false
    },

    "flag_statement": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "description": "Flag type.",
          "enum": ["preference", "runtime_flag"]
        },
        "name": {
          "type": "string",
          "description": "Name of the flag or preference to configure."
        },
        "value_to_set": {
          "type": "string",
          "description": "Value to set the flag to."
        }
      },
      "additionalProperties": false,
      "required": ["type", "name"]
    },

    "internal_support_statement": {
      "anyOf": [
        { "$ref": "#/definitions/internal_simple_support_statement" },
        {
          "type": "array",
          "minItems": 2,
          "items": {
            "$ref": "#/definitions/internal_simple_support_statement"
          }
        },
        { "const": "mirror" }
      ]
    },

    "internal_status_block": {
      "type": "object",
      "properties": {
        "experimental": {
          "type": "boolean",
          "deprecated": true,
          "description": "(This property is deprecated. Prefer using more well-defined stability calculations, such as Baseline, instead.) Usually, this value is true for single-implementer features and false for multiple-implementer features or single-implementer features that are not expected to change."
        },
        "standard_track": {
          "type": "boolean",
          "description": "Whether the feature is part of an active specification or specification process."
        },
        "deprecated": {
          "type": "boolean",
          "description": "Whether the feature is no longer recommended. It might be removed in the future or kept only for compatibility purposes."
        }
      },
      "required": ["experimental", "standard_track", "deprecated"],
      "additionalProperties": false
    },

    "internal_support_block": {
      "type": "object",
      "propertyNames": {
        "enum": [
          "bun",
          "chrome",
          "chrome_android",
          "deno",
          "edge",
          "firefox",
          "firefox_android",
          "ie",
          "nodejs",
          "oculus",
          "opera",
          "opera_android",
          "safari",
          "safari_ios",
          "samsunginternet_android",
          "webview_android",
          "webview_ios"
        ]
      },
      "additionalProperties": {
        "$ref": "#/definitions/internal_support_statement"
      },
      "tsType": "Partial<Record<BrowserName, InternalSupportStatement>>"
    },

    "spec_url_value": {
      "type": "string",
      "format": "uri",
      "pattern": "(^https://[^#]+#.+)|(^https://github.com/WebAssembly/.+)|(^https://registry.khronos.org/webgl/extensions/[^/]+/)"
    },

    "impl_url_value": {
      "type": "string",
      "format": "uri",
      "pattern": "^https://(trac.webkit.org/changeset/|hg.mozilla.org/mozilla-central/rev/|crrev.com/|bugzil.la/|crbug.com/|webkit.org/b/|github.com/GoogleChromeLabs/chromium-bidi/issues/)"
    },

    "internal_compat_statement": {
      "type": "object",
      "properties": {
        "description": {
          "type": "string",
          "description": "Human-readable description of the feature."
        },
        "mdn_url": {
          "type": "string",
          "format": "uri",
          "pattern": "^https://developer\\.mozilla\\.org/docs/",
          "description": "Link to the MDN reference page for this feature. Must be language-agnostic."
        },
        "spec_url": {
          "anyOf": [
            {
              "$ref": "#/definitions/spec_url_value"
            },
            {
              "type": "array",
              "minItems": 2,
              "items": {
                "$ref": "#/definitions/spec_url_value"
              }
            }
          ],
          "description": "URL(s) for specific parts of a specification in which this feature is defined. Each URL must contain a fragment identifier.",
          "tsType": "string | [string, string, ...string[]]"
        },
        "tags": {
          "description": "Tags assigned to the feature.",
          "type": "array",
          "minItems": 1,
          "tsType": "[string, ...string[]]"
        },
        "support": {
          "$ref": "#/definitions/internal_support_block",
          "description": "Browser support data for this feature."
        },
        "status": {
          "$ref": "#/definitions/internal_status_block",
          "description": "Information about the stability of the feature."
        }
      },
      "required": ["support"],
      "additionalProperties": false
    },

    "internal_identifier": {
      "type": "object",
      "properties": {
        "__compat": {
          "type": "object",
          "$ref": "#/definitions/internal_compat_statement",
          "required": ["status"],
          "description": "The compatibility data for a feature, nested under the `__compat` property of an identifier.",
          "tsType": "InternalCompatStatement"
        }
      },
      "patternProperties": {
        "^(?!__compat)[a-zA-Z_0-9-$@]*$": {
          "$ref": "#/definitions/internal_identifier"
        }
      },
      "additionalProperties": false,
      "errorMessage": {
        "additionalProperties": "Feature names can only contain alphanumerical characters or the following symbols: _-$@"
      },
      "tsType": "{[key: string]: InternalIdentifier} & {__compat?: InternalCompatStatement};"
    },

    "webextensions_internal_identifier": {
      "type": "object",
      "properties": {
        "__compat": { "$ref": "#/definitions/internal_compat_statement" }
      },
      "patternProperties": {
        "^(?!__compat)[a-zA-Z_0-9-$@]*$": {
          "$ref": "#/definitions/webextensions_internal_identifier",
          "tsType": "InternalIdentifier"
        }
      },
      "additionalProperties": false,
      "errorMessage": {
        "additionalProperties": "Feature names can only contain alphanumerical characters or the following symbols: _-$@"
      },
      "tsType": "{[key: string]: InternalIdentifier} & {__compat?: InternalCompatStatement}"
    }
  },

  "title": "CompatDataFile",
  "type": "object",
  "patternProperties": {
    "^(?!__compat)(?!webextensions)[a-zA-Z_0-9-$@]*$": {
      "$ref": "#/definitions/internal_identifier"
    },
    "^webextensions*$": {
      "$ref": "#/definitions/webextensions_internal_identifier",
      "tsType": "InternalIdentifier"
    },
    "^__compat$": {
      "$ref": "#/definitions/internal_compat_statement"
    }
  },
  "additionalProperties": false,
  "errorMessage": {
    "additionalProperties": "Feature names can only contain alphanumerical characters or the following symbols: _-$@"
  },
  "maxProperties": 1,
  "minProperties": 1
}
